<!doctype html>
<html lang="fa" dir="rtl" class="scroll-smooth">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>ØªÙˆÙ…Ø§Ù†Ú¯ | Ù…Ø±Ø¬Ø¹ ØªØ®ØµØµÛŒ Ù…Ø§Ù†Ú¯Ø§ Ùˆ Ù…Ø§Ù†Ù‡ÙˆØ§</title>
  <meta name="description" content="Ø¨Ù‡ØªØ±ÛŒÙ† Ù…Ø±Ø¬Ø¹ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ Ø®ÙˆØ§Ù†Ø¯Ù† Ù…Ø§Ù†Ú¯Ø§ Ùˆ Ù…Ø§Ù†Ù‡ÙˆØ§ Ø¨Ø§ ØªØ±Ø¬Ù…Ù‡ ÙØ§Ø±Ø³ÛŒ">

  <!-- Fonts & Libs -->
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Vazir', 'sans-serif'] },
          colors: {
            bg: '#02000a',
            glass: 'rgba(255, 255, 255, 0.03)',
            glassBorder: 'rgba(255, 255, 255, 0.08)',
            accent: '#7c3aed', // Violet-600
            accentHover: '#6d28d9',
            glow: '#a78bfa'
          },
          animation: {
            'float': 'float 8s ease-in-out infinite',
            'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          },
          keyframes: {
            float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-20px)' } }
          }
        }
      }
    }
  </script>

  <style>
    body { 
      background-color: #02000a;
      background-image: 
        radial-gradient(circle at 15% 50%, rgba(124, 58, 237, 0.08), transparent 25%), 
        radial-gradient(circle at 85% 30%, rgba(217, 70, 239, 0.08), transparent 25%);
      color: #e2e8f0; 
      overflow-x: hidden; 
      -webkit-tap-highlight-color: transparent; 
    }

    /* Glassmorphism Classes */
    .glass-panel {
      background: rgba(15, 15, 20, 0.6);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
    }
    
    .nav-glass {
      background: rgba(2, 0, 10, 0.85);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #02000a; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
    ::-webkit-scrollbar-thumb:hover { background: #7c3aed; }

    /* Slider */
    .slider-wrap { mask-image: linear-gradient(to bottom, black 80%, transparent 100%); }
    .slide-enter { animation: fadeScale 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards; }
    @keyframes fadeScale { from { opacity: 0; transform: scale(1.05); } to { opacity: 1; transform: scale(1); } }

    /* Cards */
    .manga-card { transition: transform 0.3s ease, box-shadow 0.3s ease; }
    .manga-card:hover { transform: translateY(-6px); box-shadow: 0 10px 40px -10px rgba(124, 58, 237, 0.3); z-index: 10; }
    .manga-card:hover .cover-img { transform: scale(1.05); }
    
    /* Interactive Elements */
    .btn-primary {
      background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
      box-shadow: 0 0 20px rgba(124, 58, 237, 0.3);
      transition: all 0.3s ease;
    }
    .btn-primary:hover { box-shadow: 0 0 30px rgba(124, 58, 237, 0.5); transform: translateY(-2px); }
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <!-- Backend Data Injection (SEO & Initial State) -->
  <script id="DATA_SOURCE" type="application/json">[{"chapter": "83", "cover": "https://cdn.jsdelivr.net/gh/im-abi-oo/mioooo@main/oo.jpg", "genres": ["\u0639\u0627\u0634\u0642\u0627\u0646\u0647", "\u0645\u062b\u0644\u062b \u0639\u0634\u0642\u06cc"], "slug": "Domestic-Girlfriend-1234", "status": "\u062f\u0631 \u062d\u0627\u0644 \u0627\u0646\u062a\u0634\u0627\u0631", "summary": "\u0646\u0645\u06cc \u062f\u0627\u0646\u0645", "titleEn": "Domestic Girlfriend", "titleFa": "\u062f\u0648\u0633\u062a \u062f\u062e\u062a\u0631\u062e\u0627\u0646\u06af\u06cc", "type": "Manga", "updatedAt": "2024-05-18"}]</script>
  <script id="CONFIG_SOURCE" type="application/json">{"apiBase": "http://localhost:5001", "authUrl": "/auth", "coverThreshold": 0.65, "faqPage": "/faq.html", "footer": {"aboutTeam": "\u062a\u0648\u0645\u0627\u0646\u06af\u061b \u0645\u0631\u062c\u0639 \u062a\u062e\u0635\u0635\u06cc \u0648 \u0622\u0631\u0634\u06cc\u0648 \u0628\u06cc\u200c\u0646\u0638\u06cc\u0631 \u0645\u0627\u0646\u06af\u0627 \u0648 \u0645\u0627\u0646\u0647\u0648\u0627. \u0645\u0627 \u062f\u0627\u0633\u062a\u0627\u0646\u200c\u0647\u0627 \u0631\u0627 \u0632\u0646\u062f\u0647 \u0645\u06cc\u200c\u06a9\u0646\u06cc\u0645.", "copyright": "\u00a9 2026 Twomang. All rights reserved.", "madeBy": "Designed \u0026 Developed by im_abi for Saino TM"}, "panelUrl": "/panel", "purchasePhysical": "https://example.com/shop", "siteNameEn": "Twomang", "siteNameFa": "\u062a\u0648\u0645\u0627\u0646\u06af", "subscribeTextFa": "\u062f\u0633\u062a\u0631\u0633\u06cc \u0646\u0627\u0645\u062d\u062f\u0648\u062f \u0628\u0627 \u0627\u0634\u062a\u0631\u0627\u06a9 \u0648\u06cc\u0698\u0647", "supportContact": "https://t.me/im_abi", "telegramChannel": "https://t.me/saino_tm"}</script>

  <!-- Navbar -->
  <nav class="fixed top-0 inset-x-0 z-50 nav-glass h-20 transition-all duration-300" id="navbar">
    <div class="max-w-[1600px] mx-auto px-6 h-full flex items-center justify-between">
      
      <!-- Logo & Links -->
      <div class="flex items-center gap-8">
        <a href="/" class="group flex items-center gap-2">
          <div class="w-10 h-10 bg-accent rounded-xl flex items-center justify-center font-black text-xl text-white shadow-lg shadow-violet-500/20 group-hover:scale-110 transition-transform">
            TM
          </div>
          <span class="hidden md:block text-2xl font-black tracking-tight text-white group-hover:text-violet-300 transition-colors">
            Twomang
          </span>
        </a>

        <!-- Desktop Menu -->
        <div class="hidden lg:flex items-center p-1 bg-white/5 rounded-2xl border border-white/5 backdrop-blur-md">
          <button onclick="App.setType('all')" data-type="all" class="nav-filter px-5 py-2 rounded-xl text-sm font-bold text-gray-300 transition-all hover:text-white hover:bg-white/5 bg-white/10 text-white shadow-inner">Ù‡Ù…Ù‡</button>
          <button onclick="App.setType('Manhwa')" data-type="Manhwa" class="nav-filter px-5 py-2 rounded-xl text-sm font-bold text-gray-400 transition-all hover:text-white hover:bg-white/5">Ù…Ø§Ù†Ù‡ÙˆØ§</button>
          <button onclick="App.setType('Manga')" data-type="Manga" class="nav-filter px-5 py-2 rounded-xl text-sm font-bold text-gray-400 transition-all hover:text-white hover:bg-white/5">Ù…Ø§Ù†Ú¯Ø§</button>
        </div>
      </div>

      <!-- Search & Auth -->
      <div class="flex items-center gap-4">
        <!-- Search Bar -->
        <div class="relative hidden md:block group">
          <input type="text" id="mainSearch" placeholder="Ø¬Ø³ØªØ¬Ùˆ (Ù†Ø§Ù…ØŒ Ú˜Ø§Ù†Ø±)..." 
            class="bg-black/40 border border-white/10 rounded-2xl px-5 py-3 pr-12 w-64 focus:w-80 focus:border-accent focus:bg-black/60 focus:ring-1 focus:ring-accent transition-all outline-none text-sm font-medium text-white placeholder-gray-500">
          <i data-lucide="search" class="absolute right-4 top-3.5 w-4 h-4 text-gray-500 group-focus-within:text-accent transition-colors"></i>
        </div>

        <!-- Auth Button (Dynamic) -->
        <div id="auth-container">
           <!-- Loaded via JS -->
           <div class="animate-pulse w-32 h-10 bg-white/5 rounded-2xl"></div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="flex-grow pt-24 pb-20 px-4 md:px-8 max-w-[1600px] mx-auto w-full">
    
    <!-- Hero Slider -->
    <section id="hero-slider" class="relative h-[400px] md:h-[500px] rounded-[2.5rem] overflow-hidden mb-16 glass-panel border-0 shadow-2xl shadow-black/50 slider-wrap group">
        <div id="slides-container" class="w-full h-full relative">
            <!-- Slides injected via JS -->
        </div>
        
        <!-- Slider Controls -->
        <div class="absolute bottom-0 inset-x-0 h-32 bg-gradient-to-t from-black via-black/60 to-transparent z-20 flex items-end justify-between p-8 md:p-12">
            <div id="slider-dots" class="flex gap-2"></div>
            <a href="#grid" class="hidden md:flex items-center gap-2 text-sm font-bold text-gray-400 hover:text-white transition-colors">
                Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¢Ø±Ø´ÛŒÙˆ <i data-lucide="arrow-down" class="w-4 h-4 animate-bounce"></i>
            </a>
        </div>
    </section>

    <div class="flex flex-col xl:flex-row gap-8 relative">
      
      <!-- Sidebar (Filters) -->
      <aside class="w-full xl:w-72 shrink-0 space-y-6">
        <div class="glass-panel p-6 rounded-3xl sticky top-24">
            <div class="flex justify-between items-center mb-6">
                <h3 class="flex items-center gap-2 text-white font-black text-lg">
                    <i data-lucide="filter" class="w-5 h-5 text-accent"></i> ÙÛŒÙ„ØªØ±Ù‡Ø§
                </h3>
                <button onclick="App.reset()" class="text-xs text-red-400 hover:text-red-300 font-bold transition">Ø­Ø°Ù Ù‡Ù…Ù‡</button>
            </div>

            <!-- Sort -->
            <div class="mb-6">
                <label class="text-xs font-bold text-gray-500 mb-3 block uppercase tracking-wider">Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ</label>
                <div class="relative">
                    <select id="sortBy" onchange="App.setSort(this.value)" class="w-full appearance-none bg-black/40 border border-white/10 rounded-xl px-4 py-3 text-sm text-white font-bold outline-none focus:border-accent transition cursor-pointer">
                        <option value="newest">ğŸ”¥ Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</option>
                        <option value="chapters">ğŸ“š Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ú†Ù¾ØªØ±</option>
                        <option value="alpha">ğŸ…° Ø­Ø±ÙˆÙ Ø§Ù„ÙØ¨Ø§</option>
                    </select>
                    <i data-lucide="chevron-down" class="absolute left-4 top-3.5 w-4 h-4 text-gray-500 pointer-events-none"></i>
                </div>
            </div>

            <!-- Status -->
            <div class="mb-6">
                <label class="text-xs font-bold text-gray-500 mb-3 block uppercase tracking-wider">ÙˆØ¶Ø¹ÛŒØª Ø§Ù†ØªØ´Ø§Ø±</label>
                <div id="status-list" class="space-y-2"></div>
            </div>

            <!-- Genres -->
            <div>
                <label class="text-xs font-bold text-gray-500 mb-3 block uppercase tracking-wider">Ú˜Ø§Ù†Ø±Ù‡Ø§</label>
                <div id="genres-list" class="flex flex-wrap gap-2"></div>
            </div>
        </div>
      </aside>

      <!-- Grid Content -->
      <div class="flex-1 min-h-[500px]">
        <div class="flex items-center justify-between mb-8 px-2">
            <div>
                <h2 class="text-2xl font-black text-white mb-1">Ø¢Ø®Ø±ÛŒÙ† Ø¹Ù†Ø§ÙˆÛŒÙ†</h2>
                <p class="text-xs text-gray-400 font-medium">Ù†Ù…Ø§ÛŒØ´ <span id="count" class="text-accent font-bold">0</span> Ø§Ø«Ø± Ø§Ø² Ø¢Ø±Ø´ÛŒÙˆ</p>
            </div>
            <!-- Mobile Search Toggle could go here -->
        </div>

        <div id="grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 2xl:grid-cols-5 gap-4 md:gap-6">
            <!-- Grid Items -->
        </div>

        <!-- Pagination -->
        <div id="pagination" class="mt-16 flex justify-center items-center gap-2"></div>
      </div>

    </div>
  </main>

  <footer class="border-t border-white/5 bg-[#010105] mt-auto">
    <div class="max-w-[1600px] mx-auto px-6 py-12 flex flex-col md:flex-row justify-between items-center gap-6">
        <div class="text-center md:text-right">
            <h4 class="font-black text-2xl text-white mb-2">Twomang</h4>
            <p class="text-xs text-gray-500 max-w-sm">ØªÙˆÙ…Ø§Ù†Ú¯Ø› Ù…Ø±Ø¬Ø¹ ØªØ®ØµØµÛŒ Ùˆ Ø¢Ø±Ø´ÛŒÙˆ Ø¨ÛŒâ€ŒÙ†Ø¸ÛŒØ± Ù…Ø§Ù†Ú¯Ø§ Ùˆ Ù…Ø§Ù†Ù‡ÙˆØ§. Ù…Ø§ Ø¯Ø§Ø³ØªØ§Ù†â€ŒÙ‡Ø§ Ø±Ø§ Ø²Ù†Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ….</p>
        </div>
        <div class="text-[10px] text-gray-600 font-mono" dir="ltr">
            Designed &amp; Developed by im_abi for Saino TM | Protected by Secure API
        </div>
    </div>
  </footer>

  <!-- Toast Notification -->
  <div id="toast" class="fixed bottom-8 left-8 transform translate-y-20 opacity-0 transition-all duration-300 z-[100] bg-zinc-900 border border-l-4 border-l-accent border-white/10 text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-4">
    <div class="bg-accent/20 p-2 rounded-full"><i data-lucide="bell" class="w-5 h-5 text-accent"></i></div>
    <span id="toast-msg" class="text-sm font-bold"></span>
  </div>

  <script>
    // --- APP CORE ---
    const App = (() => {
      // Data Load
      const ITEMS = JSON.parse(document.getElementById('DATA_SOURCE').textContent || '[]');
      const CONFIG = JSON.parse(document.getElementById('CONFIG_SOURCE').textContent || '{}');
      
      // API Settings
      const API_BASE = "https://two-api-iksq.onrender.com";
      const API_ME = `${API_BASE}/auth/me`;

      // State
      let state = {
        filtered: [],
        user: null,
        isAuthChecked: false,
        params: { type: 'all', q: '', genres: [], status: [], sort: 'newest', page: 1, limit: 20 }
      };

      // Search Engine
      const fuse = new Fuse(ITEMS, {
        keys: ['titleFa', 'titleEn', 'summary', 'genres'],
        threshold: 0.3,
        useExtendedSearch: true
      });

      // --- AUTH SYSTEM ---
      async function initAuth() {
        const token = localStorage.getItem('at');
        const container = document.getElementById('auth-container');
        
        if (!token) {
            renderAuthButton(false);
            state.isAuthChecked = true;
            return;
        }

        try {
            const res = await fetch(API_ME, { 
                headers: { 'Authorization': `Bearer ${token}` } 
            });
            
            if (res.ok) {
                state.user = await res.json();
                renderAuthButton(true);
            } else {
                // Token invalid
                localStorage.removeItem('at');
                renderAuthButton(false);
            }
        } catch (e) {
            console.error("Auth Error:", e);
            renderAuthButton(false); // Fallback to login
        } finally {
            state.isAuthChecked = true;
        }
      }

      function renderAuthButton(isLoggedIn) {
        const container = document.getElementById('auth-container');
        if (isLoggedIn) {
            const isPremium = state.user.days_left > 0;
            container.innerHTML = `
                <a href="/panel" class="btn-primary px-5 py-2.5 rounded-xl flex items-center gap-2 text-white font-bold text-sm group">
                    <span class="truncate max-w-[100px]">${state.user.username}</span>
                    <i data-lucide="user-check" class="w-4 h-4"></i>
                </a>
            `;
        } else {
            container.innerHTML = `
                <a href="/auth" class="bg-white/10 hover:bg-white/20 border border-white/10 text-white px-6 py-2.5 rounded-xl font-bold text-sm flex items-center gap-2 transition-all">
                    ÙˆØ±ÙˆØ¯ / Ø¹Ø¶ÙˆÛŒØª
                    <i data-lucide="log-in" class="w-4 h-4"></i>
                </a>
            `;
        }
        lucide.createIcons();
      }

      // --- LOGIC ---
      function applyFilters() {
        let result = ITEMS;

        // 1. Type
        if (state.params.type !== 'all') {
            result = result.filter(i => i.type.toLowerCase() === state.params.type.toLowerCase());
        }

        // 2. Search (Fuse)
        if (state.params.q) {
            const fuseResult = fuse.search(state.params.q);
            result = fuseResult.map(r => r.item);
        }

        // 3. Genres (AND logic)
        if (state.params.genres.length > 0) {
            result = result.filter(item => 
                state.params.genres.every(g => item.genres.includes(g))
            );
        }

        // 4. Status
        if (state.params.status.length > 0) {
            result = result.filter(item => state.params.status.includes(item.status));
        }

        // 5. Sort
        result = [...result]; // Clone for sort
        if (state.params.sort === 'newest') {
            result.sort((a,b) => new Date(b.updatedAt) - new Date(a.updatedAt));
        } else if (state.params.sort === 'chapters') {
            result.sort((a,b) => (parseInt(b.chapter)||0) - (parseInt(a.chapter)||0));
        } else if (state.params.sort === 'alpha') {
            result.sort((a,b) => a.titleFa.localeCompare(b.titleFa));
        }

        state.filtered = result;
        renderGrid();
        updateURL();
      }

      // --- RENDERERS ---
      function renderGrid() {
        const grid = document.getElementById('grid');
        const start = (state.params.page - 1) * state.params.limit;
        const pageItems = state.filtered.slice(start, start + state.params.limit);
        
        document.getElementById('count').innerText = state.filtered.length;

        if (pageItems.length === 0) {
            grid.innerHTML = `
                <div class="col-span-full flex flex-col items-center justify-center py-20 opacity-50">
                    <i data-lucide="frown" class="w-16 h-16 mb-4 text-gray-600"></i>
                    <p class="text-lg font-bold">Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>
                </div>
            `;
            lucide.createIcons();
            return;
        }

        grid.innerHTML = pageItems.map(item => `
          <a href="/${item.type.toLowerCase()}/${item.slug}/" class="manga-card relative block bg-white/5 border border-white/5 rounded-2xl overflow-hidden group">
            <div class="relative aspect-[2/3] overflow-hidden">
                <img src="${item.cover}" alt="${item.titleFa}" loading="lazy" class="cover-img w-full h-full object-cover transition-transform duration-500">
                <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent opacity-80"></div>
                
                <!-- Badges -->
                <div class="absolute top-2 right-2 flex flex-col gap-1 items-end">
                     ${item.status.includes('Ù¾Ø§ÛŒØ§Ù†') 
                        ? '<span class="px-2 py-1 bg-emerald-500/80 backdrop-blur text-white text-[9px] font-black rounded-md">Ú©Ø§Ù…Ù„ Ø´Ø¯Ù‡</span>' 
                        : '<span class="px-2 py-1 bg-accent/80 backdrop-blur text-white text-[9px] font-black rounded-md">Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø®Ø´</span>'}
                </div>

                <div class="absolute bottom-0 inset-x-0 p-3">
                    <span class="inline-block text-[10px] font-black bg-white text-black px-1.5 py-0.5 rounded mb-1">CH ${item.chapter}</span>
                    <h3 class="text-sm font-black text-white leading-tight truncate">${item.titleFa}</h3>
                    <p class="text-[10px] text-gray-400 font-medium truncate mt-0.5">${item.titleEn}</p>
                </div>
            </div>
          </a>
        `).join('');
        
        renderPagination();
        lucide.createIcons();
      }

      function renderPagination() {
        const totalPages = Math.ceil(state.filtered.length / state.params.limit);
        const container = document.getElementById('pagination');
        container.innerHTML = '';
        
        if (totalPages <= 1) return;

        // Simple Prev
        if (state.params.page > 1) {
             container.innerHTML += `<button onclick="App.setPage(${state.params.page - 1})" class="w-10 h-10 rounded-xl bg-white/5 hover:bg-white/10 flex items-center justify-center transition"><i data-lucide="chevron-right" class="w-4"></i></button>`;
        }

        // Pages
        let startPage = Math.max(1, state.params.page - 2);
        let endPage = Math.min(totalPages, state.params.page + 2);

        for (let i = startPage; i <= endPage; i++) {
            const isActive = i === state.params.page;
            container.innerHTML += `
                <button onclick="App.setPage(${i})" 
                    class="w-10 h-10 rounded-xl font-bold text-sm transition-all ${isActive ? 'bg-accent text-white shadow-lg shadow-accent/40 scale-110' : 'bg-white/5 text-gray-400 hover:bg-white/10'}">
                    ${i}
                </button>`;
        }

        // Simple Next
        if (state.params.page < totalPages) {
             container.innerHTML += `<button onclick="App.setPage(${state.params.page + 1})" class="w-10 h-10 rounded-xl bg-white/5 hover:bg-white/10 flex items-center justify-center transition"><i data-lucide="chevron-left" class="w-4"></i></button>`;
        }
      }

      // --- URL STATE ---
      function updateURL() {
        const p = new URLSearchParams();
        if(state.params.q) p.set('q', state.params.q);
        if(state.params.type !== 'all') p.set('type', state.params.type);
        if(state.params.genres.length) p.set('genres', state.params.genres.join(','));
        if(state.params.status.length) p.set('status', state.params.status.join(','));
        history.replaceState(null, '', '#' + p.toString());
      }

      function loadFromURL() {
        const p = new URLSearchParams(window.location.hash.slice(1));
        if(p.get('q')) { state.params.q = p.get('q'); document.getElementById('mainSearch').value = state.params.q; }
        if(p.get('type')) { state.params.type = p.get('type'); updateNavTypeUI(state.params.type); }
        if(p.get('genres')) state.params.genres = p.get('genres').split(',');
        if(p.get('status')) state.params.status = p.get('status').split(',');
      }

      function updateNavTypeUI(type) {
        document.querySelectorAll('.nav-filter').forEach(btn => {
            const isTarget = btn.dataset.type === type;
            btn.className = isTarget 
                ? 'nav-filter px-5 py-2 rounded-xl text-sm font-bold bg-white/10 text-white shadow-inner transition-all'
                : 'nav-filter px-5 py-2 rounded-xl text-sm font-bold text-gray-400 hover:text-white hover:bg-white/5 transition-all';
        });
      }

      // --- INITIALIZER ---
      return {
        init: () => {
          initAuth();
          loadFromURL();
          
          // Populate Filters
          const allGenres = [...new Set(ITEMS.flatMap(i => i.genres))].sort();
          document.getElementById('genres-list').innerHTML = allGenres.map(g => `
            <button onclick="App.toggleFilter('genres', '${g}', this)" class="px-3 py-1.5 rounded-lg border border-white/10 text-[11px] font-bold text-gray-400 hover:border-accent hover:text-accent transition-all ${state.params.genres.includes(g) ? 'bg-accent text-white border-accent' : 'bg-transparent'}">
                ${g}
            </button>
          `).join('');

          const allStatus = [...new Set(ITEMS.map(i => i.status))];
          document.getElementById('status-list').innerHTML = allStatus.map(s => `
            <button onclick="App.toggleFilter('status', '${s}', this)" class="w-full text-right px-4 py-2 rounded-xl border border-white/5 text-xs font-bold text-gray-300 hover:bg-white/5 flex justify-between items-center transition-all ${state.params.status.includes(s) ? 'bg-white/10 text-white border-l-2 border-l-accent' : ''}">
                ${s}
                <div class="w-1.5 h-1.5 rounded-full ${state.params.status.includes(s) ? 'bg-accent' : 'bg-gray-600'}"></div>
            </button>
          `).join('');

          // Events
          document.getElementById('mainSearch').addEventListener('input', (e) => {
             state.params.q = e.target.value;
             state.params.page = 1;
             applyFilters();
          });

          // Start Slider
          Slider.init(ITEMS);
          
          // Initial Render
          applyFilters();
        },
        setType: (t) => {
            state.params.type = t;
            state.params.page = 1;
            updateNavTypeUI(t);
            applyFilters();
        },
        toggleFilter: (key, val, el) => {
            const idx = state.params[key].indexOf(val);
            if(idx > -1) state.params[key].splice(idx, 1);
            else state.params[key].push(val);
            
            // Re-render filters area to update active states (simplified)
            // Ideally toggle class only, but re-render is safer for sync
            el.classList.toggle('bg-accent');
            el.classList.toggle('text-white');
            
            state.params.page = 1;
            applyFilters();
        },
        setSort: (val) => {
            state.params.sort = val;
            applyFilters();
        },
        setPage: (p) => {
            state.params.page = p;
            document.getElementById('grid').scrollIntoView({ behavior: 'smooth', block: 'start' });
            renderGrid();
        },
        reset: () => {
            window.location.hash = '';
            window.location.reload();
        }
      };
    })();

    const Slider = {
        cur: 0,
        init(items) {
            const featured = items.filter(i => i.cover).sort(() => 0.5 - Math.random()).slice(0, 5);
            const container = document.getElementById('slides-container');
            
            container.innerHTML = featured.map((item, idx) => `
                <div class="absolute inset-0 transition-opacity duration-1000 ${idx===0 ? 'opacity-100 z-10' : 'opacity-0 z-0'} slide-item">
                    <img src="${item.cover}" class="w-full h-full object-cover object-center opacity-60">
                    <div class="absolute inset-0 bg-gradient-to-r from-black via-black/40 to-transparent"></div>
                    <div class="absolute inset-y-0 right-0 w-full md:w-2/3 p-8 md:p-16 flex flex-col justify-center items-start">
                        <span class="px-3 py-1 bg-accent/20 border border-accent/50 text-accent rounded-lg text-[10px] font-black tracking-widest uppercase mb-4 backdrop-blur-md animate-pulse">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø³Ø±Ø¯Ø¨ÛŒØ±</span>
                        <h2 class="text-4xl md:text-6xl font-black text-white mb-4 leading-tight drop-shadow-lg">${item.titleFa}</h2>
                        <p class="text-gray-300 text-sm md:text-base line-clamp-2 md:line-clamp-3 max-w-lg mb-8 leading-7 opacity-90">${item.summary || ''}</p>
                        <a href="/${item.type.toLowerCase()}/${item.slug}/" class="btn-primary px-8 py-3.5 rounded-xl font-bold text-white flex items-center gap-2 group">
                            Ø´Ø±ÙˆØ¹ Ù…Ø·Ø§Ù„Ø¹Ù‡
                            <i data-lucide="arrow-left" class="w-5 h-5 group-hover:-translate-x-1 transition-transform"></i>
                        </a>
                    </div>
                </div>
            `).join('');

            const dots = document.getElementById('slider-dots');
            dots.innerHTML = featured.map((_, i) => `
                <button onclick="Slider.goto(${i})" class="h-1.5 rounded-full transition-all duration-300 ${i===0 ? 'w-8 bg-accent' : 'w-2 bg-white/30 hover:bg-white'}"></button>
            `).join('');

            this.interval = setInterval(() => this.next(), 6000);
        },
        next() {
            const slides = document.querySelectorAll('.slide-item');
            if(!slides.length) return;
            this.goto((this.cur + 1) % slides.length);
        },
        goto(idx) {
            const slides = document.querySelectorAll('.slide-item');
            const dots = document.querySelectorAll('#slider-dots button');
            
            slides[this.cur].classList.replace('opacity-100', 'opacity-0');
            slides[this.cur].classList.replace('z-10', 'z-0');
            dots[this.cur].className = 'h-1.5 w-2 bg-white/30 rounded-full transition-all duration-300 hover:bg-white';

            this.cur = idx;

            slides[this.cur].classList.replace('opacity-0', 'opacity-100');
            slides[this.cur].classList.replace('z-0', 'z-10');
            slides[this.cur].classList.add('slide-enter'); // Re-trigger scale anim
            setTimeout(() => slides[this.cur].classList.remove('slide-enter'), 1000);
            
            dots[this.cur].className = 'h-1.5 w-8 bg-accent rounded-full transition-all duration-300';
        }
    };

    document.addEventListener('DOMContentLoaded', App.init);
  </script>
</body>
</html>
